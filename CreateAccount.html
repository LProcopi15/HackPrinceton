<head>	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
	<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="http://jqueryvalidation.org/files/dist/jquery.validate.min.js"></script>
	<script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js"></script>
	<script src="https://github.com/jzaefferer/jquery-validation"></script> 
</head>
	<script>
  		// This is called with the results from from FB.getLoginStatus().
  		function statusChangeCallback(response) {
    		console.log('statusChangeCallback');
    		console.log(response);
	    	// The response object is returned with a status field that lets the
	    	// app know the current login status of the person.
	    	// Full docs on the response object can be found in the documentation
	    	// for FB.getLoginStatus().
	    	if (response.status === 'connected') {
      			// Logged into your app and Facebook.
      			console.log(response.authResponse.accessToken);
      			FB.api('/me', function(response) {
    				console.log(JSON.stringify(response));
    				//get the users name and username
    				document.getElementById("facebook_name").value = response.name;
    				document.getElementById("facebook_username").value = response.id;

    				//submit the user information to our SQL script
    				document.getElementById('submission').action = "userCreationSQL.php";
    				document.getElementById('submission').submit();
	  			});
/*	  			FB.api('/me?fields=first_name', function(response) {
	  				document.getElementById("facebook_firstname").value = response.first_name;
	  				document.getElementById('submission').action = "userCreationSQL.php";
    				document.getElementById('submission').submit();
	  			});	  			
	  			FB.api('/me?fields=last_name', function(response) {
	  				document.getElementById("facebook_lastname").value = response.last_name;
	  				document.getElementById('submission').action = "userCreationSQL.php";
    				document.getElementById('submission').submit();
	  			});
*/
	  			FB.api('/me?fields=email', function(response) {
	  				document.getElementById("facebook_email").value = response.email;
	  				document.getElementById('submission').action = "userCreationSQL.php";
    				document.getElementById('submission').submit();
	  			});
	  			//Call facebook picture
	  			FB.api('/me/picture?width=180&height=180', function(response) {
    				document.getElementById("facebook_picture").value = response.data.url;
	  				document.getElementById('submission').action = "userCreationSQL.php";
    				document.getElementById('submission').submit();
	  			});

      			testAPI();
    		} else if (response.status === 'not_authorized') {
      			// The person is logged into Facebook, but not your app.
      			document.getElementById('status').innerHTML = 'Please log ' +
        			'into this app.';
   			} else {
      			// The person is not logged into Facebook, so we're not sure if
      			// they are logged into this app or not.
      		document.getElementById('status').innerHTML = 'Please log ' +
        		'into Facebook.';
    		}
  		}

		// This function is called when someone finishes with the Login
		// Button.  See the onlogin handler attached to it in the sample
		// code below.
		function checkLoginState() {
			FB.getLoginStatus(function(response) {
		    	statusChangeCallback(response);
		    }); 
		}

		window.fbAsyncInit = function() {
			FB.init({
		    	appId      : '204505849880545',
		    	cookie     : true,  // enable cookies to allow the server to access 
		                        // the session
		    	xfbml      : true,  // parse social plugins on this page
		    	version    : 'v2.2', // use version 2.2
		  	});

		// Now that we've initialized the JavaScript SDK, we call 
		// FB.getLoginStatus().  This function gets the state of the
		// person visiting this page and can return one of three states to
		// the callback you provide.  They can be:
		//
		// 1. Logged into your app ('connected')
		// 2. Logged into Facebook, but not your app ('not_authorized')
		// 3. Not logged into Facebook and can't tell if they are logged into
		//    your app or not.
		//
		// These three cases are handled in the callback function.

	  		FB.getLoginStatus(function(response) {
	    		statusChangeCallback(response);
	  		});

	  	};

  		// Load the SDK asynchronously
  		(function(d, s, id) {
    		var js, fjs = d.getElementsByTagName(s)[0];
    		if (d.getElementById(id)) return;
    			js = d.createElement(s); js.id = id;
    			js.src = "//connect.facebook.net/en_US/sdk.js";
    			fjs.parentNode.insertBefore(js, fjs);
  		}(document, 'script', 'facebook-jssdk'));

  		// Here we run a very simple test of the Graph API after login is
  		// successful.  See statusChangeCallback() for when this call is made.
  		function testAPI() {
    		console.log('Welcome!  Fetching your information.... ');
    		FB.api('/me', function(response) {
      		console.log('Successful login for: ' + response.name + response.p);
      		document.getElementById('status').innerHTML =
        	'Thanks for logging in, ' + response.name + '!';

    });
}
	</script>
<body>
	<form action="/HackPrinceton/userCreationSQL.php" method='post' id='submission'>
	        <label>Name: <input name="name"/></label><br>
	        <label>Username: <input name="username"/></label><br>
	        <label>Email: <input name="email"type="email"/><br></label>
	        <label>Password: <input name="password1" id="password"/></label><br>
	        <label>Confirm Password: <input name="password2"/></label><br>

	        <input name="facebook_name" id="facebook_name"  type="hidden"></input>
	        <input name="facebook_username" id="facebook_username" type="hidden"></input>
	        <input name="facebook_email" id="facebook_email"  type="hidden"></input>
	        <input name="facebook_picture" id="facebook_picture"  type="hidden"></input>
	        <input type="submit" value="Create Account" id="create_account">
	</form>

<fb:login-button scope="public_profile,email,user_likes" auth_type="rerequest" onlogin="checkLoginState();">
</fb:login-button>

<div id="status">
</div>
</body>
<script>
$().ready(function() {
	$("#submission").validate({
		rules: {
			name: "required",
			username: {
				required: true,
			},
			email: {
				required: true,
				email: true
			},
			password1: {
				required: true,
				minlength: 6,
			},
			password2: {
				required: true,
				minlength: 6,
				equalTo: "#password"
			},
		},
		messages: {
			name: "Please enter a name",
			username: "Please enter a username",
			email: "Please enter a valid email",
			password: {
				required: "Please provide a password",
				minlength: "Your password must be at least 6 characters"
			},
		}
	});
});

</script>